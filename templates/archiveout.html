<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dear, You</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<header>
    <h1>DEAR, YOU_</h1>
    <div class="line"></div>
    <p class="subtext">digital love letters</p>
    <div class="auth-buttons">
        <button onclick="openModal('login')">Login</button>
        <button onclick="openModal('signup')">Sign Up</button>
    </div>
</header>

<div class="main-container">
    <div class="left-panel">  
            <a href="{{ url_for('index') }}" class="back-btn">← Back</a>

            <form method="GET" class="search-bar">
                <input type="text" name="search" placeholder="SEARCH FOR NAME" value="{{ search }}">
            </form> 
           

        <div class="letters-grid">
            {% for letter in letters %}
            
                <div class="letter-card">
            <a href="{{ url_for('display_letter_out_archive', letter_id=letter.id) }}" class="letter-card-link">
                    <p class="letter-title">DEAR, {{ letter.recipient|upper }}</p>
                    <p class="letter-date">{{ letter.created.strftime('%b.%d,%Y')|upper }}</p>
                    <p class="letter-message">{{ letter.message }}</p>
            </a>        
                    <form action="/react/{{ letter.id }}" method="POST">
                        <button type="button" onclick="openModal('login')">❤️</button>
                        <span class="heart-count">{{ letter.hearts }}</span>
                    </form>
                </div>
            
            {% endfor %}
        </div>
    </div>    
</div>

<!-- AUTH MODAL -->
<div class="auth-modal" id="authModal">
    <div class="auth-box">
        <h2 id="authTitle">Login</h2>
        <form id="authForm" method="POST">
            <!-- Fields will be injected by JS -->
        </form>
        <div id="errorMessage" style="margin-top:10px; color:red; font-size:0.9rem;">
            {% if error %}
                {{ error }}
            {% endif %}
        </div>
        <div id="toggleContainer" style="margin-top:15px; font-size:0.9rem; color:var(--text-main);"></div>
    </div>
</div>

<script>
function openModal(mode) {
    const modal = document.getElementById('authModal');
    const title = document.getElementById('authTitle');
    const form = document.getElementById('authForm');
    const toggleContainer = document.getElementById('toggleContainer');
    const errorMessage = document.getElementById('errorMessage');

    modal.style.display = 'flex';

    // Keep any server-side error if exists
    let serverError = errorMessage.textContent;

    if (mode === 'login') {
        title.textContent = 'Login';
        form.action = '/login';
        form.innerHTML = `
            <input type="email" name="email" placeholder="Email" required />
            <input type="password" name="password" placeholder="Password" required />
            <button type="submit">Continue</button>
        `;
        toggleContainer.innerHTML = `Don’t have an account? <a href="#" onclick="switchAuth('signup')">Sign Up</a>`;
    } else if (mode === 'signup') {
        title.textContent = 'Sign Up';
        form.action = '/signup';
        form.innerHTML = `
            <input type="email" name="email" placeholder="Email" required />
            <input type="password" name="password" placeholder="Password" required />
            <button type="submit">Create Account</button>
        `;
        toggleContainer.innerHTML = `Already have an account? <a href="#" onclick="switchAuth('login')">Login</a>`;
    }

    // Restore server-side error if present
    if (serverError) {
        errorMessage.textContent = serverError;
    }
}

function switchAuth(mode) {
    openModal(mode);
}

// Clicking outside the modal closes it
window.addEventListener('click', function(e) {
    const modal = document.getElementById('authModal');
    if (e.target === modal) {
        modal.style.display = 'none';
        // Clear error when closing
        document.getElementById('errorMessage').textContent = '';
    }
});

// Open modal automatically if server tells us to (e.g., after redirect with error)
{% if show_modal %}
openModal("{{ form_mode }}");
{% endif %}
</script>
</body>
</html>









